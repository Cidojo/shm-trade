'use strict';

(function(){
var a={
block:{},
maps:{},
isInitEventConstructor:!1,
initConstructor:function(){return function(c,d,e){
var f=this;
if(d){
var g=c.closest('.ul-container');

f.block[g.attr('id')]={id:g.attr('id'),mapSettings:d},

this.renderMap(c,d,!0,function(h){
f.isInitEventConstructor||
f.constructorEvents(),

e(h);

});
}
}}(),


constructorEvents:function(){return function(){
var c=this;
c.isInitEventConstructor=!0;
var d=function(){return function(){
c.block&&
$.each(c.block,function(){
var f=this;
setTimeout(function(){
f.map&&
f.map.fitToViewport(f.mapSettings.options.bounds);

},1e3);
});

}}();

$(window).
off('.mapBackgroundResizeConstructor').
on('addElelment.mapBackgroundResizeConstructor',d).
on('colResized.mapBackgroundResizeConstructor',d).
on('endWidgetEdit.mapBackgroundResizeConstructor',d);
}}(),


initPublish:function(){return function(){
var c=this;
$.each($('.ul-container','#body-fict'),function(){
var d=$(this);

if('map'==d.attr('data-bgtype')){
var e=null;

try{
e=JSON.parse(d.attr('data-map-settings'));
}
catch(f){
console.error('map settings JSON parse failed');
}

if(!e)
return;


c.block[d.attr('id')]={id:d.attr('id'),mapSettings:e},
c.renderMap($('.js-background-map',d),e,!1);
}
});
}}(),

renderMap:function(){return function(c,d,e,f){
var g=this,
h=['map-helper/'+d.options.provider];

'google'===d.options.provider&&
h.push('json!/widgets/maps/json/styles_googlemaps.json'),

d.markers||(d.markers=[]),
g.block[c.closest('.ul-container').attr('id')].map=null,
require(h,function(i,j){
c.empty(),
i({
$el:c,
mapOpts:{
mapTypeId:d.options.mapTypeId,
styles:j?j[d.options.styleNumber]:null,
draggable:e,
mapTypeControl:e,
zoomControl:e,
panControl:e,
streetViewControl:e,
scrollWheel:!1,
bounds:{
northWest:{
latitude:d.options.bounds.northWest.latitude,
longitude:d.options.bounds.northWest.longitude},

southEast:{
latitude:d.options.bounds.southEast.latitude,
longitude:d.options.bounds.southEast.longitude}}},



markers:d.markers.
filter(function(k){
return k.isEnabled;
}).
map(function(k){
return{
id:k.id,
latitude:+k.latitude,
longitude:+k.longitude,
text:g.getMarkerText(k.title,k.description),
isDraggable:e};

})},
function(k){

g.block[c.closest('.ul-container').attr('id')]={
id:c.closest('.ul-container').attr('id'),
mapSettings:d,
map:k},

g.event(),
f&&f(k);
});
});
}}(),

getMarkerText:function(){return function(c,d){

if(!c&&!d)

return'';


var e=[];






return c&&e.push('<b>'+c+'</b>'),d&&e.push(d),'<span style="color: #000;">'+e.join('<br>')+'</span>';
}}(),

event:function(){return function(){
var c=this,
d=function(){return function(){
$.each(c.block,function(){
var f=this,
g=$('.js-background-map',$('#'+f.id));
g.length&&
c.block[f.id].map&&c.block[f.id].map&&
setTimeout(function(){
c.block&&c.block[f.id]&&c.block[f.id].map&&
c.block[f.id].map.fitToViewport(f.mapSettings.options.bounds);

},1e3);
});

}}();
$(window).off('resize.mapBackgroundResize'),
$(window).on('resize.mapBackgroundResize',d);
}}()};


window.constructorMode?
define('mapBgRender',['jquery'],function(){
return a;
}):

require(['jquery'],function(){
a.initPublish();
});

})();
//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map

//# sourceMappingURL=backgroundBlockMap.js.map
