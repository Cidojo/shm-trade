'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a};define('ul-fileinput',['jquery','i18n-view','asyncjs'],function(a,b,c){var e=function fileinput(f){this.$el=f.$el,this.allowedMimeTypes=f.allowedMimeTypes,this.maxFileSize=f.maxFileSize,this.maxSumSize=f.maxSumSize,this.maxFiles=f.maxFiles,this.specialFileList=f.specialFileList||!1,this.selectFile=f.selectFile||function(){},this.error=f.error||function(){},this.open=f.open||function(){},this.files={}};return e.prototype={init:function init(){var f=this;f.attachListeners()},attachListeners:function attachListeners(){var f=this;this.$el.off('.fileInputEvent').on('click.fileInputEvent','.js-file-input-remove',f.removeLoadFile.bind(f)).on('click.fileInputEvent','.js-file-input-button',f.openFileDialog.bind(f)).on('change.fileInputEvent','.js-file-input-control',f.filesSelected.bind(f))},removeLoadFile:function removeLoadFile(f){var g=this,h=a('.js-file-input-control',g.$el),j=a(f.currentTarget).closest('.js-file-input-filename'),k=j.attr('data-file');g.files&&g.files[k]&&(delete g.files[k],h.val(''),j.remove())},openFileDialog:function openFileDialog(f){var g=this;if(!(a(f.target).hasClass('js-file-input-remove')||a(f.target).hasClass('js-file-input-filename'))){var h=a(f.currentTarget);g.files={},a('.js-file-input-control',g.$el).val(''),h.parent('.js-file-input').find('.js-file-input-filename').remove(),h.parent('.js-file-input').find('.js-file-input-label').removeClass('d-file-input-label-error').text(''),h.parent('.js-file-input').find('.js-file-input-control').click(),g.open()}},clearLabel:function clearLabel(){var f=this;f.files={},f.$el.find('.js-file-input-filename').remove(),f.$el.find('.js-file-input-label').removeClass('d-file-input-label-error').text('')},clearInput:function clearInput(){var f=this;f.files={},f.$el.find('.js-file-input-filename').remove(),f.$el.find('.js-file-input-control').val('')},checkMimeTypes:function checkMimeTypes(f){var g,h;for(g=0;g<f.length;g+=1)if(h=f[g],-1===this.allowedMimeTypes.indexOf(h.type))return h.name;return null},checkFilesSize:function checkFilesSize(f){var g,h;for(g=0;g<f.length;g+=1)if(h=f[g],h.size>this.maxFileSize)return h.name;return null},checkSizeSum:function checkSizeSum(f){var g,h=0;for(g=0;1<f.length&&g<f.length;g+=1)h+=f[g].size;return h>this.maxSumSize?(h/1048576).toFixed(1):null},checkMinSize:function checkMinSize(f){var g,h=null;for(g=0;g<f.length;g+=1)0===f[g].size&&(h=!0);return h},filesSelected:function filesSelected(f){var n,g=this,h=a(f.currentTarget),j=h[0],k=j.files,l=!1,m='',p=function appendFileName(q,s){a('.js-file-input-button',g.$el).append('<span class="ul-file-name js-file-input-filename g-color-text-3" data-file="'+q+'">'+s.name.trim()+'<span class="fa fa-trash js-file-input-remove  ul-file-input-remove-icon"></span></span>')};n=['checkMimeTypes','checkSizeSum','checkMinSize','checkFilesSize'].map(function(q){var s=g[q](k);return{r:s,validator:q}}).filter(function(q){return null!==q.r}).shift(),'object'===('undefined'==typeof n?'undefined':_typeof(n))&&'checkSizeSum'===n.validator?(m=b('constructor.too big sum size').replace('{sumSize}',n.r),m=m.replace('{maxSumSize}',this.maxSumSize/1048576),l=!0):'object'===('undefined'==typeof n?'undefined':_typeof(n))&&'checkFilesSize'===n.validator?(m=b('constructor.too big file').replace('{fileName}',n.r),m=m.replace('{size}',this.maxFileSize/1048576),l=!0):'object'===('undefined'==typeof n?'undefined':_typeof(n))&&'checkMimeTypes'===n.validator?(m=b('constructor.wrong file type').replace('{fileName}',n.r),l=!0):g.maxFiles&&g.maxFiles<k.length?(m=b('constructor.too many files',g.maxFiles).replace('{count}',g.maxFiles),l=!0):'object'===('undefined'==typeof n?'undefined':_typeof(n))&&'checkMinSize'===n.validator?(m=b('constructor.too empty file'),l=!0):0===k.length?m='':1===k.length?(g.specialFileList?(p(0,k[0]),g.selectFile(k[0])):m=k[0].name,g.files[0]=k[0]):1<k.length&&(g.specialFileList?(a.each(k,function(q,s){p(q,s)}),g.selectFile(k)):m=b('all.attching files')+' '+k.length,a.each(k,function(q,s){g.files[q]=s})),l&&(h.val(''),g.specialFileList?g.errorMessage(m):g.error(m)),h.parent('.js-file-input').find('.js-file-input-label').toggleClass('d-file-input-label-error',l).text(m)},errorMessage:function errorMessage(f){var g=this;a('.js-file-input-button',g.$el).append('<span class="js-file-input-filename ul-file-name ul-file-name-error">'+f+'</span>')},getFileInput:function getFileInput(){var f=this;return f.files},upload:function upload(f,g){var m,n,h=this.$el.find('.js-file-input-control'),j=h[0],k=j.files||[],l=[];for(n=0;n<k.length;n+=1)l.push(k[n]);c.map(l,function(p,q){m=new FormData,m.append('file',p),a.ajax({url:f,method:'POST',data:m,processData:!1,contentType:!1,doNotShowAjax404Error:!0,success:function success(s){q.apply(null,s)},error:function error(){q(!0,null)}})},g)}},e});
//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map

//# sourceMappingURL=fileinput.js.map
